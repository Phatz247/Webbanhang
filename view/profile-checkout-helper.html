<!-- Add this to profile.php before closing </body> tag -->
<script src="js/checkout-helper.js"></script>

<!-- Or if you prefer inline in profile.php, add this script: -->
<script>
  // Inline checkout restoration helper for profile.php
  function restoreCheckout() {
    const savedState = sessionStorage.getItem("checkout_state");
    if (savedState) {
      const checkoutState = JSON.parse(savedState);

      // Check if state is still valid (within 30 minutes)
      const thirtyMinutes = 30 * 60 * 1000;
      if (Date.now() - checkoutState.timestamp < thirtyMinutes) {
        // Redirect back to checkout with restoration data
        const form = document.createElement("form");
        form.method = "POST";
        form.action = "checkout.php";
        form.style.display = "none";

        // Add selected items
        checkoutState.selected_items.forEach((item) => {
          const input = document.createElement("input");
          input.type = "hidden";
          input.name = "selected_items[]";
          input.value = item;
          form.appendChild(input);
        });

        // Add other form data
        if (checkoutState.payment_method) {
          const paymentInput = document.createElement("input");
          paymentInput.type = "hidden";
          paymentInput.name = "payment_method";
          paymentInput.value = checkoutState.payment_method;
          form.appendChild(paymentInput);
        }

        if (checkoutState.notes) {
          const notesInput = document.createElement("input");
          notesInput.type = "hidden";
          notesInput.name = "notes";
          notesInput.value = checkoutState.notes;
          form.appendChild(notesInput);
        }

        document.body.appendChild(form);
        form.submit();
        return true;
      } else {
        sessionStorage.removeItem("checkout_state");
      }
    }
    return false;
  }

  // Show return to checkout notification
  document.addEventListener("DOMContentLoaded", function () {
    const savedState = sessionStorage.getItem("checkout_state");
    if (savedState) {
      const checkoutState = JSON.parse(savedState);
      const thirtyMinutes = 30 * 60 * 1000;

      if (Date.now() - checkoutState.timestamp < thirtyMinutes) {
        // Create notification banner
        const banner = document.createElement("div");
        banner.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; margin: 20px 0; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"%23ffffff\" opacity=\"0.1\"><polygon points=\"1000,100 1000,0 0,0 0,85\"/></svg>'); background-size: cover;"></div>
                    <div style="position: relative; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center;">
                            <i class="fas fa-shopping-cart" style="font-size: 1.5rem; margin-right: 15px; animation: pulse 2s infinite;"></i>
                            <div>
                                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 3px;">Đơn hàng đang chờ thanh toán</div>
                                <div style="opacity: 0.9; font-size: 0.9rem;">Bạn có ${checkoutState.selected_items.length} sản phẩm đang chờ thanh toán</div>
                            </div>
                        </div>
                        <button onclick="restoreCheckout()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                            <i class="fas fa-arrow-left" style="margin-right: 8px;"></i> Quay lại thanh toán
                        </button>
                    </div>
                </div>
                <style>
                    @keyframes pulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.1); }
                    }
                </style>
            `;

        // Insert at top of main content
        const profileContainer = document.querySelector(
          ".profile-container, .container, main"
        );
        if (profileContainer) {
          profileContainer.insertBefore(banner, profileContainer.firstChild);
        } else {
          document.body.insertBefore(banner, document.body.firstChild);
        }
      }
    }
  });
</script>
